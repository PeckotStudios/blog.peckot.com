+++
title = 'OBS浏览器源样式注入的完美解决方案'
date = 2025-04-14T09:11:34+08:00
tags = ['OBS','OBS Studio','直播','前端','浏览器','反向代理','CSS','网页','样式注入']
author = 'Pectics'
description = '使用forward+overwrite完美解决OBS浏览器源样式注入问题'
+++

## 背景

在 OBS 中使用“浏览器源”加载网页（比如弹幕姬、弹幕墙、通知栏等）时，我们经常会遇到以下痛点：

- 想修改一些样式（比如字体大小、行距、颜色等），但不生效
- 尝试通过 `style` 注入或 JS 动态控制，但发现完全没有作用
- 即便搭建了本地代理服务器，仍然会因为资源加载顺序、CSP 限制、动态 CSS 插入等问题导致失败

这让我一度认为 OBS 浏览器源“根本不支持样式修改”，直到我找到了一个名为 [`forward`](https://github.com/axetroy/forward) 的工具。

`forward` 是一个极小巧的反向代理工具，它支持通过 `--overwrite` 参数，**精确覆盖页面加载过程中的任意资源文件**，最终实现对页面样式的“钓鱼式劫持”。

更重要的是：你**不需要安装 Go 环境**，在它的 [Releases 页面](https://github.com/axetroy/forward/releases) 就可以下载适配 Windows 的二进制可执行文件，直接运行即可。

---

## 🚧 一开始尝试的失败方案

作为一个前端工程师，我一开始尝试了以下几种方式：

- 在 OBS 里设置的“自定义 CSS”中写样式 ✅ → 发现没效果 ❌
- 自己用 Node.js 写一个中间人代理注入 `<style>` ✅ → 页面能加载，但样式不一定生效 ❌
- 通过 DevTools 找到目标 CSS，用 JS 动态移除再替换 ✅ → OBS 内核不支持这些 JS 动作 ❌

举个 Node.js 尝试的例子：

```js
const express = require('express');
const fetch = require('node-fetch');
const app = express();

app.all('*', async (req, res) => {
  const url = 'https://目标地址.com' + req.originalUrl;
  const method = req.method;
  const headers = { ...req.headers, host: undefined };

  const proxyRes = await fetch(url, {
    method,
    headers,
    body: ['GET', 'HEAD'].includes(method) ? undefined : req
  });

  let contentType = proxyRes.headers.get('content-type');
  let body = await proxyRes.text();

  if (contentType && contentType.includes('text/html')) {
    body = body.replace('</head>', `
      <style>#message { font-size: 20px; }</style>
    </head>`);
  }

  res.setHeader('Content-Type', contentType);
  res.send(body);
});

app.listen(3000);
```

虽然能跑，但你很快会发现：要想完善资源注入、跨域控制、压缩解码、路径替换、CDN 处理……这个代理复杂度远远超出“只是想改个样式”的初衷。

于是我决定放弃重复造轮子，选用成熟的工具 `forward`。

---

## 🔥 最终的破局：使用 `forward` + `overwrite`

### 安装 forward（两种方式）

- **方式 A：直接下载二进制可执行文件（推荐）**
  [点击进入 Releases 页面](https://github.com/axetroy/forward/releases)，下载与你系统对应的可执行文件，解压后可直接运行。

- **方式 B：使用 Go 安装（可选）**

```bash
go install github.com/axetroy/forward@latest
```

---

### 构造 overwrite 目录结构

假设网页中加载了一个远程字体：

```html
<link rel="stylesheet" href="//at.alicdn.com/t/font_2143783_iq6z4ey5vu.css">
```

你就需要在本地创建以下路径并替换文件内容：

```
overwrites/
└── at.alicdn.com/
    └── t/
        └── font_2143783_iq6z4ey5vu.css
```

内容可以是：

```css
body { font-family: '你的字体' !important; }
/* 甚至把整个 iconfont 全部干掉 */
```

---

### 覆盖动态加载的 CSS

有些 CSS 是通过 JS 动态插入的，比如：

```js
const style = document.createElement('link');
style.rel = 'stylesheet';
style.href = 'https://cdn.xxx.com/ui.css';
document.head.appendChild(style);
```

你只需找到这段 JS 的路径，在 `overwrite` 中对应位置创建并注释掉插入语句。

---

### 注入最终的样式覆盖

找准最后会加载的那段 CSS（通常在 HTML 尾部），在其中最后加入我们自己的样式：

```css
/* 最终覆盖区域 */
#message {
  display: inline;
  font-size: 20px;
}
yt-live-chat-renderer * {
  font-size: 20px;
}
```

---

### 启动代理

```bash
forward --port=3000 --overwrite=./overwrites https://xiaofaduo.com
```

注意：这里只需要 `--overwrite`，如果你并不需要代理外域资源，`--proxy-external` 可以省略。

然后在 OBS 浏览器源中填写：

```
http://localhost:3000/live
```

---

## ✅ 最终结果

- 样式准确注入，字体、布局随意改 ✅
- 所有远程资源都本地化、可控 ✅
- JS 插入逻辑被精确控制 ✅
- OBS 完美渲染，不再掉链子 ✅

我把这套方案完整验证并稳定使用，适用于所有“无法注入样式的嵌入式网页”场景，尤其适配 OBS 浏览器源等内嵌 Chromium 内核容器。

---

以上就是我在 OBS 中使用 `forward` + `overwrite` 完美解决浏览器源样式注入问题的经验分享。希望对大家有所帮助！